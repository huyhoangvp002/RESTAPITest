<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã Th√¥ng tin c√° nh√¢n</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="page-container">
        <div class="card">
            <h1 class="title">üìã Th√¥ng tin c√° nh√¢n</h1>
            <p class="subtitle">Vui l√≤ng c·∫≠p nh·∫≠t th√¥ng tin c√° nh√¢n c·ªßa b·∫°n</p>
            
            <form class="form" id="info-form">
                <div class="form-group">
                    <label for="name">H·ªç v√† t√™n:</label>
                    <input type="text" id="name" name="name" class="form-input" placeholder="Nh·∫≠p h·ªç v√† t√™n" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" class="form-input" placeholder="Nh·∫≠p email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">S·ªë ƒëi·ªán tho·∫°i:</label>
                    <input type="text" id="phone" name="phone_number" class="form-input" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" required>
                </div>
                
                <div class="form-group">
                    <label for="address">ƒê·ªãa ch·ªâ:</label>
                    <input type="text" id="address" name="address" class="form-input" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
                </div>
                
                <button type="submit" class="btn btn-success btn-full">
                    <span class="btn-text">üíæ L∆∞u th√¥ng tin</span>
                    <span class="loading" id="loading" style="display: none;"></span>
                </button>
            </form>
            
            <div class="nav-links">
                <a href="/static/home.html">üè† V·ªÅ trang ch·ªß</a>
                <a href="/static/products.html">üõí Xem s·∫£n ph·∫©m</a>
            </div>
        </div>
    </div>

    <script>
        function getCookie(name) {
            return document.cookie.split("; ").reduce((r, v) => {
                const parts = v.split("=");
                return parts[0] === name ? decodeURIComponent(parts[1]) : r;
            }, "");
        }

        document.getElementById("info-form").addEventListener("submit", async function(e) {
            e.preventDefault();
            
            const loading = document.getElementById("loading");
            const btnText = document.querySelector(".btn-text");
            
            // Show loading
            loading.style.display = "inline-block";
            btnText.style.display = "none";

            const payload = {
                name: document.getElementById("name").value,
                email: document.getElementById("email").value,
                phone_number: document.getElementById("phone").value,
                address: document.getElementById("address").value
            };

            try {
                const token = getCookie("access_token");
                const response = await fetch("/create_info", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                // Hide loading
                loading.style.display = "none";
                btnText.style.display = "inline";

                if (!response.ok) {
                    const data = await response.json();
                    alert("‚ùå L·ªói: " + (data.error || "Kh√¥ng r√µ"));
                    return;
                }

                alert("‚úÖ L∆∞u th√¥ng tin th√†nh c√¥ng!");
                window.location.href = "/static/home.html";

            } catch (err) {
                loading.style.display = "none";
                btnText.style.display = "inline";
                console.error("L·ªói g·ª≠i th√¥ng tin:", err);
                alert("‚ùå Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server!");
            }
        });
    </script>
</body>
</html>
