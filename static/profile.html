<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘¤ ThÃ´ng Tin TÃ i Khoáº£n</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="page-container">
        <div class="card">
            <div class="profile-avatar">
                <img src="/static/images/default.jpg" alt="Avatar" class="avatar-image" id="avatar-img">
            </div>
            
            <h1 class="title">ğŸ‘¤ ThÃ´ng Tin TÃ i Khoáº£n</h1>
            <p class="subtitle">Xem vÃ  quáº£n lÃ½ thÃ´ng tin cÃ¡ nhÃ¢n</p>
            
            <div class="profile-content" id="profile-content">
                <div class="loading-container">
                    <div class="loading"></div>
                    <p>Äang táº£i thÃ´ng tin...</p>
                </div>
            </div>
            
            <div class="alert alert-error" id="error-msg" style="display: none;">
                <p id="error-text"></p>
                <button class="btn btn-primary" id="login-btn" style="display: none;">
                    ğŸ” ÄÄƒng nháº­p
                </button>
            </div>
            
            <div class="nav-links">
                <a href="/static/home.html">ğŸ  Trang chá»§</a>
                <a href="/static/products.html">ğŸ›’ Sáº£n pháº©m</a>
                <a href="/static/info_change.html">âœï¸ Sá»­a thÃ´ng tin</a>
                <button onclick="logout()" class="btn btn-danger">ğŸšª ÄÄƒng xuáº¥t</button>
            </div>
        </div>
    </div>

    <script>
        function getCookie(name) {
            return document.cookie.split("; ").reduce((r, v) => {
                const parts = v.split("=");
                return parts[0] === name ? decodeURIComponent(parts[1]) : r;
            }, "");
        }

        function deleteCookie(name) {
            document.cookie = name + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }

        function logout() {
            if (confirm("ğŸ¤” Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n Ä‘Äƒng xuáº¥t?")) {
                deleteCookie("access_token");
                deleteCookie("refresh_token");
                deleteCookie("cart");
                alert("ğŸ‘‹ ÄÃ£ Ä‘Äƒng xuáº¥t thÃ nh cÃ´ng!");
                window.location.href = "/static/landing_page.html";
            }
        }

        function showError(message) {
            const errorMsg = document.getElementById('error-msg');
            const errorText = document.getElementById('error-text');
            const loginBtn = document.getElementById('login-btn');
            const profileContent = document.getElementById('profile-content');

            profileContent.style.display = 'none';
            errorText.textContent = message;
            errorMsg.style.display = "block";
            loginBtn.style.display = "inline-block";

            loginBtn.onclick = function () {
                window.location.href = "/static/login.html";
            };
        }

        function displayProfile(data) {
            const profileContent = document.getElementById('profile-content');
            
            profileContent.innerHTML = `
                <div class="user-info">
                    <h3>ğŸ“‹ ThÃ´ng tin cÃ¡ nhÃ¢n</h3>
                    <div class="profile-table">
                        <div class="profile-row">
                            <span class="profile-label">ğŸ‘¤ TÃ i khoáº£n:</span>
                            <span class="profile-value">${data.username || 'ChÆ°a cáº­p nháº­t'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ“§ Email:</span>
                            <span class="profile-value">${data.email || 'ChÆ°a cáº­p nháº­t'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ‘¨â€ğŸ’¼ Há» tÃªn:</span>
                            <span class="profile-value">${data.name || 'ChÆ°a cáº­p nháº­t'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ“± Sá»‘ Ä‘iá»‡n thoáº¡i:</span>
                            <span class="profile-value">${data.phone_number || 'ChÆ°a cáº­p nháº­t'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ  Äá»‹a chá»‰:</span>
                            <span class="profile-value">${data.address || 'ChÆ°a cáº­p nháº­t'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ‘¥ Vai trÃ²:</span>
                            <span class="profile-value role-badge">${data.role || 'User'}</span>
                        </div>
                        <div class="profile-row">
                            <span class="profile-label">ğŸ“… Táº¡o lÃºc:</span>
                            <span class="profile-value">${data.created_at ? new Date(data.created_at).toLocaleString('vi-VN') : 'ChÆ°a rÃµ'}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Simple JWT payload decoder (without verification)
        function parseJWT(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));
                return JSON.parse(jsonPayload);
            } catch (e) {
                console.error('Error parsing JWT:', e);
                return null;
            }
        }

        async function loadProfile() {
            const res = await fetch('/profile', {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include'
            });
            if (res.ok) {
                const info = await res.json();
                displayProfile(info); // <-- ThÃªm dÃ²ng nÃ y!
            } else {
                showError("KhÃ´ng thá»ƒ táº£i thÃ´ng tin cÃ¡ nhÃ¢n!");
            }
        }

        // Detect if background image loads successfully
        const img = new Image();
        img.onload = function() {
            document.body.classList.add('bg-loaded');
        };
        img.onerror = function() {
            console.log('âš ï¸ Background image bg.png not found, using gradient fallback');
        };
        img.src = '/static/images/bg.png';

        // Load profile when page loads
        loadProfile();
    </script>
</body>
</html> 